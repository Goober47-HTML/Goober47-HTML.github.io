<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script type="module" src="https://unpkg.com/@google/model-viewer@3.3.0/dist/model-viewer.min.js"></script>
  <title>Bulborb</title>
</head>
<body>

<h1>HELLO!</h1>

<p style="font-family: 'Comic Sans MS'">i am bulborb</p>
<p style="font-family: 'Comic Sans MS'">|</p>
<p style="font-family: 'Comic Sans MS'">\/</p>

<model-viewer id="bulborb"
              src="model.glb"
              alt="Bulborb"
              camera-controls
              auto-rotate
              shadow-intensity="1"
              reveal="auto"
              expose-attributes="*"
              style="width: 600px; height: 400px;">
</model-viewer>

<button onclick="playAnimation('Walk')">Walk</button>
<button onclick="playAnimation('Idle')">Idle</button>

<script>
  console.log("SCRIPT LOADED");

  const modelViewer = document.getElementById('bulborb');

  function playAnimation(name) {
    modelViewer.animationName = name;
    modelViewer.play();
  }

  modelViewer.addEventListener('load', async () => {
    console.log("LOAD EVENT FIRED");

    // Wait for model + sceneGraphRoot
    while (!modelViewer.model || !modelViewer.model.sceneGraphRoot) {
      console.log("Waiting for model.sceneGraphRoot...");
      await new Promise(r => setTimeout(r, 50));
    }

    console.log("MODEL + SCENE READY");

    const root = modelViewer.model.sceneGraphRoot;

    // Print tree
    function printTree(node, depth = 0) {
      console.log(" ".repeat(depth * 2) + "- " + node.name);
      if (node.children) {
        for (const child of node.children) {
          printTree(child, depth + 1);
        }
      }
    }

    console.log("=== SCENE GRAPH ===");
    printTree(root);

    // Recursive search
    function findNode(node, name) {
      if (node.name === name) return node;
      if (!node.children) return null;
      for (const child of node.children) {
        const result = findNode(child, name);
        if (result) return result;
      }
      return null;
    }

    const leftEye = findNode(root, 'leye');
    const rightEye = findNode(root, 'reye');

    console.log("FOUND leftEye:", leftEye);
    console.log("FOUND rightEye:", rightEye);

    if (!leftEye || !rightEye) {
      console.warn("Eyes not found");
      return;
    }

    window.addEventListener('mousemove', (event) => {
      const x = (event.clientX / window.innerWidth) * 2 - 1;
      const y = (event.clientY / window.innerHeight) * 2 - 1;

      leftEye.rotation.y = x * 0.5;
      leftEye.rotation.x = -y * 0.5;

      rightEye.rotation.y = x * 0.5;
      rightEye.rotation.x = -y * 0.5;
    });
  });
</script>

</body>
</html>
