<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <title>WEBSITE!!</title>
</head>
<body>

<h1>HELLO!</h1>

<p style="font-family: 'Comic Sans MS'">i am bulborb</p>
<p style="font-family: 'Comic Sans MS'">|</p>
<p style="font-family: 'Comic Sans MS'">\/</p>

<model-viewer id="bulborb"
              src="model.glb"
              alt="Bulborb"
              camera-controls
              auto-rotate
              shadow-intensity="1"
              style="width: 600px; height: 400px;">
</model-viewer>

<button onclick="playAnimation('Walk')">Walk</button>
<button onclick="playAnimation('Idle')">Idle</button>

<script>
  console.log("SCRIPT LOADED");
  const modelViewer = document.getElementById('bulborb');

  function playAnimation(name) {
    modelViewer.animationName = name;
    modelViewer.play();
  }

  modelViewer.addEventListener('model-visibility', async () => {
    while (!modelViewer.model || !modelViewer.model.scene) {
      await new Promise(r => setTimeout(r, 50));
    }
    modelViewer.addEventListener('model-visibility', () => {
  console.log("MODEL-VISIBILITY FIRED");
});

    playAnimation('Idle');

    const root = modelViewer.model.scene;

    function findNode(node, name) {
      if (node.name === name) return node;
      if (!node.children) return null;
      for (const child of node.children) {
        const result = findNode(child, name);
        if (result) return result;
      }
      return null;
    }

    const leftEye = findNode(root, 'leye');
    const rightEye = findNode(root, 'reye');

    console.log("FOUND leftEye:", leftEye);
    console.log("FOUND rightEye:", rightEye);

    if (!leftEye || !rightEye) {
      console.warn("Eyes not found");
      return;
    }

    // Log rotation every frame
    modelViewer.addEventListener('frame', () => {
      console.log("LeftEye rot:", leftEye.rotation.x, leftEye.rotation.y, leftEye.rotation.z);
      console.log("RightEye rot:", rightEye.rotation.x, rightEye.rotation.y, rightEye.rotation.z);
    });

    window.addEventListener('mousemove', (event) => {
      const x = (event.clientX / window.innerWidth) * 2 - 1;
      const y = (event.clientY / window.innerHeight) * 2 - 1;

      console.log("Setting rotation to:", x, y);

      leftEye.rotation.y = x * 0.5;
      leftEye.rotation.x = -y * 0.5;

      rightEye.rotation.y = x * 0.5;
      rightEye.rotation.x = -y * 0.5;
    });
  });
</script>

<a href="models.html">
  <button>Go Back</button>
</a>

</body>
</html>
